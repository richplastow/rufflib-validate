!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):((t="undefined"!=typeof globalThis?globalThis:t||self).rufflib=t.rufflib||{},t.rufflib.validate=t.rufflib.validate||{},t.rufflib.validate.main=r())}(this,(function(){"use strict";function t(r){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(r)}function r(t,r){for(var n=0;n<r.length;n++){var e=r[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function n(t,n,e){return n&&r(t.prototype,n),e&&r(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function e(t){return function(t){if(Array.isArray(t))return a(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,r){if(!t)return;if("string"==typeof t)return a(t,r);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a(t,r)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}
/**
   * rufflib-validate 0.0.1
   * A RuffLIB library for succinctly validating JavaScript values.
   * https://richplastow.com/rufflib-validate
   * @license MIT
   */()}function a(t,r){(null==r||r>t.length)&&(r=t.length);for(var n=0,e=new Array(r);n<r;n++)e[n]=t[n];return e}var c="array",i="boolean",o="integer",s="number",l="string",u="object",f="undefined";function h(r,n,e){var a=n.concat(e).join(".");return t(r)===f?"'".concat(a,"' of a value"):"".concat(r,".").concat(a)}function y(r,n,a){if(null===r||t(r)!==u||Array.isArray(r)){var h=p(r);return n||0!==a.length?n?0===a.length?"'".concat(n,"' is ").concat(h," not an object"):"'".concat(n,".").concat(a.join("."),"' is ").concat(h," not an object"):"'".concat(a.join("."),"' of the schema is ").concat(h," not an object"):"unnamed schema is ".concat(h," not an object")}var b=r._meta;if(null===b||t(b)!==u||Array.isArray(b)){var v=p(b);return n||0!==a.length?n?0===a.length?"'".concat(n,"._meta' is ").concat(v," not an object"):"'".concat(n,".").concat(a.join("."),"._meta' is ").concat(v," not an object"):"'".concat(a.join("."),"._meta' of the schema is ").concat(v," not an object"):"unnamed schema '._meta' is ".concat(v," not an object")}for(var d in r)if("_meta"!==d){var g=r[d];if(null===g||t(g)!==u||Array.isArray(g))return m(n,a,d,"is ".concat(p(g)," not an object"));if(g._meta){var k=y(g,n,[].concat(e(a),[d]));if(k)return k}else{if(null===g.fallback)return m(n,a,d,"is null","fallback");if(null===g.max)return m(n,a,d,"is null","max");if(null===g.min)return m(n,a,d,"is null","min");if(null===g.rule)return m(n,a,d,"is null","rule");if(null===g.set)return m(n,a,d,"is null","set");var A=Array.isArray(g.fallback)?c:t(g.fallback),x=Array.isArray(g.max)?c:t(g.max),N=Array.isArray(g.min)?c:t(g.min),j=Array.isArray(g.rule)?c:t(g.rule),w=Array.isArray(g.set)?c:t(g.set),E=A!==f,_=x!==f,S=N!==f,V=j!==f,O=w!==f,T=_+S+V+O;if(T>1&&(2!==T||!_||!S))return m(n,a,d,"has '".concat(T,"' qualifiers, only 0 or 1 allowed"));switch(g.kind){case c:return"@TODO array";case i:if(A!==i&&E)return m(n,a,d,"has '".concat(A,"' fallback, not '").concat(i,"' or '").concat(f,"'"));if(_)return m(n,a,d,"has '".concat(x,"' max, not '").concat(f,"'"));if(S)return m(n,a,d,"has '".concat(N,"' min, not '").concat(f,"'"));if(V)return m(n,a,d,"has '".concat(j,"' rule, not '").concat(f,"'"));if(O)return m(n,a,d,"has '".concat(w,"' set, not '").concat(f,"'"));break;case o:case s:if(A!==s&&E)return m(n,a,d,"has '".concat(A,"' fallback, not '").concat(s,"' or '").concat(f,"'"));if(x!==s&&_)return m(n,a,d,"has '".concat(x,"' max, not '").concat(s,"' or '").concat(f,"'"));if(N!==s&&S)return m(n,a,d,"has '".concat(N,"' min, not '").concat(s,"' or '").concat(f,"'"));if(j===u){var I=t(g.rule.test);if("function"!==I)return m(n,a,d,"has '".concat(I,"' rule.test, not 'function'"))}else if(V)return m(n,a,d,"has '".concat(j,"' rule, not '").concat(u,"' or '").concat(f,"'"));if(w===c)for(var C=0,D=g.set.length;C<D;C++){var P=t(g.set[C]);if(P!==s)return m(n,a,d,"has '".concat(P,"' set[").concat(C,"], not '").concat(s,"'"))}else if(O)return m(n,a,d,"has '".concat(w,"' set, not an array or '").concat(f,"'"));break;case l:if(A!==l&&E)return m(n,a,d,"has '".concat(A,"' fallback, not '").concat(l,"' or '").concat(f,"'"));if(x!==s&&_)return m(n,a,d,"has '".concat(x,"' max, not '").concat(s,"' or '").concat(f,"'"));if(N!==s&&S)return m(n,a,d,"has '".concat(N,"' min, not '").concat(s,"' or '").concat(f,"'"));if(j===u){var R=t(g.rule.test);if("function"!==R)return m(n,a,d,"has '".concat(R,"' rule.test, not 'function'"))}else if(V)return m(n,a,d,"has '".concat(j,"' rule, not '").concat(u,"' or '").concat(f,"'"));if(w===c)for(var q=0,M=g.set.length;q<M;q++){var U=t(g.set[q]);if(U!==l)return m(n,a,d,"has '".concat(U,"' set[").concat(q,"], not '").concat(l,"'"))}else if(O)return m(n,a,d,"has '".concat(w,"' set, not an array or '").concat(f,"'"));break;default:return m(n,a,d,"not recognised","kind")}}}return null}function m(t,r,n,e,a){return"'".concat(t?t+".":"").concat(0===r.length?"":r.join(".")+".").concat(n||"").concat(a?"."+a:"","'").concat(t?"":" of the schema"," ").concat(e)}function p(r){return null===r?"null":Array.isArray(r)?"an array":"type '".concat(t(r),"'")}var b=n((function t(r,n){!function(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,t),this.err=null,this.prefix=r||"(anon)",this.skip=n||!1}));return b.VERSION="0.0.1",b.prototype._type=function(r,n,e){var a=t(r);if(a===e)return!0;var c="string"==typeof n?" of a value"===n.slice(-11)?n:"'".concat(n,"'"):"a value";return this.err=null===r?"".concat(this.prefix,": ").concat(c," is null not type '").concat(e,"'"):Array.isArray(r)?"".concat(this.prefix,": ").concat(c," is an array not type '").concat(e,"'"):"".concat(this.prefix,": ").concat(c," is type '").concat(a,"' not '").concat(e,"'"),!1},b.prototype._validateAgainstSchema=function(r,n,e){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];for(var y in e)if("_meta"!==y){var m=r[y],p=t(m),b=e[y];if(b._meta){if(null===m||p!==u||Array.isArray(m)){var v=h(n,a,y),d=" of a value"===v.slice(-11)?v:"'".concat(v,"'"),g=null===m?"null":p!==u?"type '".concat(p,"'"):"an array";return this.err="".concat(this.prefix,": ").concat(d," is ").concat(g," not an object"),!1}if(!this._validateAgainstSchema(m,n,b,a.concat(y)))return!1}else{var k=t(b.fallback),A=k!==f,x=p===f;if(!A||!x){var N=h(n,a,y);switch(b.kind){case c:return"@TODO array";case i:if(!this.boolean(m,N))return!1;continue;case o:case s:case l:var j=t(b.max)!==f,w=t(b.min)!==f;if(j&&w){if(!this[b.kind](m,N,b.min,b.max))return!1}else if(w){if(!this[b.kind](m,N,b.min))return!1}else if(j){if(!this[b.kind](m,N,void 0,b.max))return!1}else if(b.rule){if(!this[b.kind](m,N,b.rule))return!1}else if(b.set){if(!this[b.kind](m,N,b.set))return!1}else if(!this[b.kind](m,N))return!1;continue;default:throw this.err="oops!!",Error(this.err)}}}}return!0},b.prototype.array=function(r,n){if(this.err=null,this.skip)return!0;if(!Array.isArray(r)){var a="string"==typeof n?" of a value"===n.slice(-11)?n:"'".concat(n,"'"):"a value";return this.err=null===r?"".concat(this.prefix,": ").concat(a," is null not an array"):"".concat(this.prefix,": ").concat(a," is type '").concat(t(r),"' not an array"),!1}for(var c=arguments.length,i=new Array(c>2?c-2:0),o=2;o<c;o++)i[o-2]=arguments[o];var s=i.length;if(!s)return!0;var l=0,u=1/0,f=null,h=[],y=t(i[0]),m="function"===y?"fn":"number"===y?"num":null==i[0]?"null":"other",p=t(i[1]),b="function"===p?"fn":"number"===p?"num":null==i[1]?"null":"other",v=t(i[2]),d="function"===v?"fn":"number"===v?"num":null==i[2]?"null":"other";switch("".concat(m,",").concat(b,",").concat(d)){case"null,null,null":for(var g=3;g<s;g++)if(null!=i[g])throw this.err="Validate.array() incorrectly invoked 1: args[".concat(g,"] not nullish!"),Error(this.err);return!0;case"num,null,null":for(var k=3;k<s;k++)if(null!=i[k])throw this.err="Validate.array() incorrectly invoked 2: args[".concat(k,"] not nullish!"),Error(this.err);l=i[0];break;case"num,num,null":for(var A=3;A<s;A++)if(null!=i[A])throw this.err="Validate.array() incorrectly invoked 3: args[".concat(A,"] not nullish!"),Error(this.err);l=i[0],u=i[1];break;case"null,num,null":for(var x=3;x<s;x++)if(null!=i[x])throw this.err="Validate.array() incorrectly invoked 4: args[".concat(x,"] not nullish!"),Error(this.err);u=i[1];break;case"num,num,fn":l=i[0],u=i[1],f=i[2],h=i.slice(3);break;case"num,null,fn":l=i[0],f=i[2],h=i.slice(3);break;case"null,num,fn":u=i[1],f=i[2],h=i.slice(3);break;default:if("fn"===m)f=i[0],h=i.slice(1);else{if("num"!==m||"fn"!==b)throw this.err="Validate.array() incorrectly invoked 5: args is not one of the nine configurations!",Error(this.err);l=i[0],f=i[1],h=i.slice(2)}}if(Number.isNaN(l))throw this.err="Validate.array() incorrectly invoked: min is NaN!",Error(this.err);if(Number.isNaN(u))throw this.err="Validate.array() incorrectly invoked: max is NaN!",Error(this.err);if(r.length<l){var N=n?"'".concat(n,"'"):"array";return this.err="".concat(this.prefix,": ").concat(N," length ").concat(r.length," is < ").concat(l),!1}if(r.length>u){var j=n?"'".concat(n,"'"):"array";return this.err="".concat(this.prefix,": ").concat(j," length ").concat(r.length," is > ").concat(u),!1}if(null==f)return!0;for(var w=n||"",E=0,_=r.length;E<_;E++)if(!f.bind(this).apply(void 0,[r[E],"".concat(w,"[").concat(E,"]")].concat(e(h))))return!1;return!0},b.prototype.boolean=function(t,r){return this.err=null,!!this.skip||this._type(t,r,"boolean")},b.prototype.integer=function(t,r,n,e){if(this.err=null,this.skip)return!0;if(!this.number(t,r,n,e))return!1;if(0!=t%1){var a="string"==typeof r?" of a value"===r.slice(-11)?r:"'".concat(r,"'"):"number";return this.err="".concat(this.prefix,": ").concat(a," ").concat(t," is not an integer"),!1}return!0},b.prototype.number=function(r,n,e,a){if(this.err=null,this.skip)return!0;if(!this._type(r,n,"number"))return!1;if(Number.isNaN(r))return this.err="".concat(this.prefix,": '").concat(n,"' is NaN, not a valid number"),!1;var c="object"===t(e)&&null!=e,i="string"==typeof n?" of a value"===n.slice(-11)?n:"'".concat(n,"'"):"number";if(c&&Array.isArray(e)){if(-1!==e.indexOf(r))return!0;var o="[".concat(e,"]");return o=o.length<21?o:"".concat(o.slice(0,12),"...").concat(o.slice(-5)),this.err="".concat(this.prefix,": ").concat(i," ").concat(r," is not in ").concat(o),!1}if(c&&"function"==typeof e.test){if(e.test(r))return!0;var s="".concat(e.test);return s=s.length<21?s:"".concat(s.slice(0,12),"...").concat(s.slice(-5)),this.err="".concat(this.prefix,": ").concat(i," ").concat(r," fails ").concat(s),!1}if("number"==typeof e){var l=e;if(Number.isNaN(l))throw this.err="Validate.number() incorrectly invoked: min is NaN!",Error(this.err);if(r<l)return this.err="".concat(this.prefix,": ").concat(i," ").concat(r," is < ").concat(l),!1}if("number"==typeof a){if(Number.isNaN(a))throw this.err="Validate.number() incorrectly invoked: max is NaN!",Error(this.err);if(r>a)return this.err="".concat(this.prefix,": ").concat(i," ").concat(r," is > ").concat(a),!1}return!0},b.prototype.object=function(r,n,e){if(this.err=null,this.skip)return!0;var a=t(n)===l?" of a value"===n.slice(-11)?n:"'".concat(n,"'"):"a value";if(null===r)return this.err="".concat(this.prefix,": ").concat(a," is null not an object"),!1;if(Array.isArray(r))return this.err="".concat(this.prefix,": ").concat(a," is an array not an object"),!1;if(!this._type(r,n,"object"))return!1;if(t(e)===f)return!0;if(!this.schema(e,"schema"))throw Error("Validate.object() incorrectly invoked: ".concat(this.err));return!!this._validateAgainstSchema(r,n,e)},b.prototype.schema=function(t,r){if(this.err=null,this.skip)return!0;var n=y(t,r,[]);return!n||(this.err="".concat(this.prefix,": ").concat(n),!1)},b.prototype.string=function(r,n,e,a){if(this.err=null,this.skip)return!0;if(!this._type(r,n,"string"))return!1;var c="object"===t(e)&&null!=e,i="string"==typeof n?" of a value"===n.slice(-11)?n:"'".concat(n,"'"):"string";if(c&&Array.isArray(e)){if(-1!==e.indexOf(r))return!0;var o='"'.concat(r,'"');o=o.length<21?o:"".concat(o.slice(0,12),"...").concat(o.slice(-5));var s="[".concat(e,"]");return s=s.length<21?s:"".concat(s.slice(0,12),"...").concat(s.slice(-5)),this.err="".concat(this.prefix,": ").concat(i," ").concat(o," is not in ").concat(s),!1}if(c&&"function"==typeof e.test){if(e.test(r))return!0;var l='"'.concat(r,'"');l=l.length<21?l:"".concat(l.slice(0,12),"...").concat(l.slice(-5));var u="".concat(e instanceof RegExp?e:e.test);return u=u.length<21?u:"".concat(u.slice(0,12),"...").concat(u.slice(-5)),this.err="".concat(this.prefix,": ").concat(i," ").concat(l," fails ").concat(u),!1}if("number"==typeof e){var f=e;if(Number.isNaN(f))throw this.err="Validate.string() incorrectly invoked: min is NaN!",Error(this.err);if(r.length<f)return this.err="".concat(this.prefix,": ").concat(i," length ").concat(r.length," is < ").concat(f),!1}if("number"==typeof a){if(Number.isNaN(a))throw this.err="Validate.string() incorrectly invoked: max is NaN!",Error(this.err);if(r.length>a)return this.err="".concat(this.prefix,": ").concat(i," length ").concat(r.length," is > ").concat(a),!1}return!0},b}));
